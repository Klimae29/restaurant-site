---
// src/components/Header.astro - Version debug
---

<header class="fixed top-0 w-full z-50 backdrop-blur-md shadow-xl transition-all duration-300"
        style="background-color: var(--color-primary)"
        id="header">
    <div class="w-full px-6">
      <nav class="flex items-center justify-between py-4">

      <!-- Logo -->
      <div class="z-20 relative">
        <a href="#hero" class="block group transform transition-all duration-300">
          <h1 class="font-['Dancing_Script'] text-3xl md:text-4xl font-bold text-yellow-400 group-hover:text-white transition-colors duration-300">
            Coraz√≥n Latino
          </h1>
          <p class="font-sans text-xs text-white/70 tracking-wide mt-1 hidden md:block group-hover:text-yellow-200 transition-colors duration-300">
            Authentic Sud-American
          </p>
        </a>
      </div>

      <!-- Menu Burger -->
      <div class="z-20 relative">
        <button
          id="burger-btn"
          class="burger-menu relative w-10 h-10 focus:outline-none group flex flex-col items-center justify-center"
          aria-label="Menu"
        >
          <!-- Lignes du burger stylis√©es -->
          <span class="burger-line block w-7 h-0.5 bg-yellow-400 transition-all duration-300 ease-in-out mb-1.5 group-hover:bg-white"></span>
          <span class="burger-line block w-7 h-0.5 bg-yellow-400 transition-all duration-300 ease-in-out mb-1.5 group-hover:bg-white"></span>
          <span class="burger-line block w-7 h-0.5 bg-yellow-400 transition-all duration-300 ease-in-out group-hover:bg-white"></span>

          <!-- Texte "MENU" en dessous -->
          <span class="text-xs text-yellow-400 font-medium mt-1 group-hover:text-white transition-colors duration-300 hidden md:block">
            MENU
          </span>
        </button>
      </div>
    </nav>
  </div>

  <!-- Menu Lateral Droit -->
  <div id="mobile-menu" class="menu-overlay fixed top-0 right-0 h-full w-full md:w-96 bg-red-900 transform translate-x-full transition-all duration-500 ease-out shadow-2xl z-40">
    <!-- Background Pattern d√©coratif -->
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-20 right-10 w-32 h-32 border border-yellow-400/30 rounded-full animate-pulse"></div>
      <div class="absolute bottom-32 left-8 w-24 h-24 border border-yellow-400/20 rotate-45"></div>
      <div class="absolute top-1/2 right-16 w-16 h-16 bg-yellow-400/10 rounded-full"></div>
    </div>

    <div class="relative h-full flex flex-col">
      <!-- Header du menu avec bouton fermer -->
      <div class="flex justify-between items-center p-6 border-b border-yellow-400/20">
        <div class="font-['Dancing_Script'] text-2xl md:text-3xl text-yellow-400 font-bold">
          Menu
        </div>
        <button
          id="close-menu"
          class="w-10 h-10 flex items-center justify-center rounded-full bg-yellow-400/20 hover:bg-yellow-400/30 transition-all duration-300 group"
        >
          <svg class="w-5 h-5 text-yellow-400 group-hover:rotate-90 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Navigation principale -->
      <div class="flex-1 flex flex-col justify-center px-6 py-8 bg-red-800 rounded-bl-lg">
        <nav class="space-y-6">
          <a href="#hero" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            üè† Accueil
          </a>

          <a href="#nos-plats" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            üçΩÔ∏è Nos Plats
          </a>

          <a href="#menu" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            üìã La Carte
          </a>

          <a href="#le-restaurant" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            üì∏ Le Restaurant
          </a>

          <!-- <a href="#avis-clients" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            ‚≠ê Avis Clients
          </a> -->

          <a href="#contact" class="nav-item block py-4 px-6 text-xl font-medium text-white hover:text-yellow-400 hover:bg-yellow-400/10 rounded-lg transition-all duration-300 transform hover:translateX(5px) border-l-4 border-transparent hover:border-yellow-400">
            üìû Contact
          </a>
        </nav>
      </div>
    </div>
  </div>

  <!-- Overlay sombre pour fermer le menu -->
  <div id="menu-backdrop" class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-500 z-30"></div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Header script charg√©');

    // R√©cup√©ration des √©l√©ments DOM avec debug
    const header = document.getElementById('header');
    const burgerBtn = document.getElementById('burger-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('close-menu');
    const menuBackdrop = document.getElementById('menu-backdrop');
    const navItems = document.querySelectorAll('.nav-item');
    const burgerLines = document.querySelectorAll('.burger-line');

    // Debug des √©l√©ments trouv√©s
    console.log('üîç √âl√©ments DOM:', {
      header: !!header,
      burgerBtn: !!burgerBtn,
      mobileMenu: !!mobileMenu,
      closeMenu: !!closeMenu,
      menuBackdrop: !!menuBackdrop,
      navItems: navItems.length
    });

    // Debug des sections cibles
    console.log('üéØ Sections trouv√©es sur la page:');
    ['hero', 'nos-plats', 'menu', 'le-restaurant', 'avis-clients', 'contact'].forEach(id => {
      const element = document.getElementById(id);
      console.log(`  #${id}:`, !!element);
      if (!element) {
        console.warn(`‚ùå Section #${id} introuvable !`);
      }
    });

    let isMenuOpen = false;

    // Fonction pour ouvrir le menu
    function openMenu() {
      console.log('üçî Ouverture du menu');
      isMenuOpen = true;

      // Afficher le menu lat√©ral - glisse depuis la droite
      mobileMenu.classList.remove('translate-x-full');
      mobileMenu.classList.add('translate-x-0');

      // Afficher l'overlay sombre
      menuBackdrop.classList.remove('opacity-0', 'pointer-events-none');
      menuBackdrop.classList.add('opacity-100', 'pointer-events-auto');

      // Animer les lignes du burger vers X
      burgerLines[0].style.transform = 'rotate(45deg) translate(6px, 6px)';
      burgerLines[1].style.opacity = '0';
      burgerLines[1].style.transform = 'translateX(20px)';
      burgerLines[2].style.transform = 'rotate(-45deg) translate(6px, -6px)';

      // Animation √©chelonn√©e des √©l√©ments de navigation
      navItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateX(30px)';
        setTimeout(() => {
          item.style.opacity = '1';
          item.style.transform = 'translateX(0)';
        }, index * 100 + 200);
      });

      // Bloquer le scroll
      document.body.style.overflow = 'hidden';
    }

    // Fonction pour fermer le menu
    function closeMenuFunc() {
      console.log('‚ùå Fermeture du menu');
      isMenuOpen = false;

      // Cacher le menu lat√©ral - glisse vers la droite
      mobileMenu.classList.add('translate-x-full');
      mobileMenu.classList.remove('translate-x-0');

      // Cacher l'overlay sombre
      menuBackdrop.classList.add('opacity-0', 'pointer-events-none');
      menuBackdrop.classList.remove('opacity-100', 'pointer-events-auto');

      // Restaurer les lignes du burger
      burgerLines[0].style.transform = 'none';
      burgerLines[1].style.opacity = '1';
      burgerLines[1].style.transform = 'none';
      burgerLines[2].style.transform = 'none';

      // D√©bloquer le scroll
      document.body.style.overflow = '';
    }

    // Initialiser les transitions des nav items
    navItems.forEach((item) => {
      item.style.transition = 'all 0.4s cubic-bezier(0.23, 1, 0.32, 1)';
    });

    // Event listeners avec debug
    if (burgerBtn) {
      burgerBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('üñ±Ô∏è Clic burger, menu ouvert:', isMenuOpen);
        if (isMenuOpen) {
          closeMenuFunc();
        } else {
          openMenu();
        }
      });
      console.log('‚úÖ Event listener burger ajout√©');
    } else {
      console.error('‚ùå Burger button non trouv√© !');
    }

    if (closeMenu) {
      closeMenu.addEventListener('click', closeMenuFunc);
      console.log('‚úÖ Event listener fermer ajout√©');
    }

    // Fermer quand on clique sur un lien de navigation
    navItems.forEach((item, index) => {
      item.addEventListener('click', function(e) {
        const href = item.getAttribute('href');
        console.log(`üîó Clic navigation ${index + 1}:`, href);

        if (href && href.startsWith('#')) {
          e.preventDefault();
          const targetElement = document.querySelector(href);
          console.log(`üéØ Cible "${href}":`, !!targetElement);

          if (targetElement) {
            // Fermer le menu d'abord
            setTimeout(() => {
              closeMenuFunc();
              // Puis scroll vers la section avec offset
              setTimeout(() => {
                const headerHeight = header ? header.offsetHeight : 80;
                const elementPosition = targetElement.offsetTop;
                const offsetPosition = elementPosition - headerHeight - 0; // 20px de marge

                window.scrollTo({
                  top: Math.max(0, offsetPosition), // √âvite les valeurs n√©gatives
                  behavior: 'smooth'
                });
              }, 300);
            }, 200);
          } else {
            console.warn(`‚ùå Section ${href} non trouv√©e !`);
          }
        }
      });
    });

    // Fermer avec la touche Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && isMenuOpen) {
        closeMenuFunc();
      }
    });

    // Fermer en cliquant sur l'overlay sombre
    if (menuBackdrop) {
      menuBackdrop.addEventListener('click', closeMenuFunc);
    }

    // Effet de scroll pour le header
    let lastScrollY = window.scrollY;
    let ticking = false;

    function updateHeader() {
      const currentScrollY = window.scrollY;

      // Changement de transparence
      if (currentScrollY > 50) {
        header.classList.remove('bg-red-700/95');
        header.classList.add('bg-red-700');
      } else {
        header.classList.add('bg-red-700/95');
        header.classList.remove('bg-red-700');
      }

      // R√©duction de l'opacit√© lors du scroll
      if (!isMenuOpen) {
        if (currentScrollY > lastScrollY && currentScrollY > 200) {
          header.style.opacity = '0.7';
        } else {
          header.style.opacity = '1';
        }
      }

      lastScrollY = currentScrollY;
      ticking = false;
    }

    window.addEventListener('scroll', function() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }, { passive: true });
  });
</script>

<style>
  /* Transitions douces pour le header */
  #header {
    transition: background-color 0.3s ease, opacity 0.3s ease;
  }

  /* Animation hover pour les nav items */
  .nav-item {
    position: relative;
    overflow: hidden;
  }

  .nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
  }

  .nav-item:hover::before {
    left: 100%;
  }

  /* Style pour le burger menu */
  .burger-line {
    transform-origin: center;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .nav-item {
      font-size: 1.125rem;
      padding: 1rem 1.5rem;
    }

    #mobile-menu {
      width: 100%;
    }
  }

  /* Animation des √©l√©ments d√©coratifs */
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: .5; }
  }
</style>
